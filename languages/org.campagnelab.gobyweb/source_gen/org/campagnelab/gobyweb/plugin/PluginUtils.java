package org.campagnelab.gobyweb.plugin;

/*Generated by MPS */

import java.io.File;
import java.io.IOException;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import com.esotericsoftware.wildcard.Paths;

public class PluginUtils {


  protected static File createDistributionPackage(File sourceDir) throws IOException {
    List<String> command = ListSequence.fromList(new ArrayList<String>());
    File pluginJar = new File(sourceDir.getAbsolutePath(), "plugin.jar");
    if (System.getenv().containsKey("JDK_HOME")) {
      ListSequence.fromList(command).addElement(System.getenv("JDK_HOME") + "/bin/jar");
    } else {
      ListSequence.fromList(command).addElement("jar");
    }
    ListSequence.fromList(command).addElement("cvf");
    ListSequence.fromList(command).addElement(pluginJar.getAbsolutePath());
    Paths paths = new Paths();
    for (String classFile : paths.glob(sourceDir.getAbsolutePath(), "*.class").getRelativePaths()) {
      ListSequence.fromList(command).addElement(sourceDir.getName() + File.separator + classFile);
    }
    try {
      ProcessBuilder p = new ProcessBuilder(command);
      p.directory(sourceDir.getParentFile());
      Process proc = p.start();
      proc.waitFor();
    } catch (InterruptedException ie) {
      throw new IOException("unable to create the distribution package for this plugin");
    }
    return pluginJar;
  }
}
